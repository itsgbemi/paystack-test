<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>E-Commerce with Paystack</title>
  <style>
    body { font-family: Arial, sans-serif; }
    .product { margin: 20px; padding: 20px; border: 1px solid #ddd; }
    button { padding: 10px 20px; background-color: #28a745; color: white; border: none; }
  </style>
</head>
<body>
  <h1>Welcome to the E-Commerce Store</h1>

  <!-- Product 1 -->
  <div class="product">
    <h2>Bra</h2>
    <p>Price: ₦1500</p>
    <button class="payButton" data-name="Bra" data-price="1500">Buy Now</button>
  </div>

  <!-- Product 2 -->
  <div class="product">
    <h2>Headphone</h2>
    <p>Price: ₦2000</p>
    <button class="payButton" data-name="Headphone" data-price="2000">Buy Now</button>
  </div>

  <!-- Product 3 -->
  <div class="product">
    <h2>Sunglasses</h2>
    <p>Price: ₦10000</p>
    <button class="payButton" data-name="Sunglasses" data-price="10000">Buy Now</button>
  </div>

  <script src="https://js.paystack.co/v1/inline.js"></script>
  <script>
    document.querySelectorAll('.payButton').forEach(button => {
      button.addEventListener('click', async () => {
        const name = button.dataset.name;
        const price = button.dataset.price;

        const email = prompt("Enter your email:");

        if (!email) {
          alert("Please provide your email.");
          return;
        }

        // Send data to backend to initialize payment
        const response = await fetch('https://paystack-backend-test.vercel.app/pay', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ email, amount: price }),
        });

        const data = await response.json();

        if (data.status === 'success') {
          const handler = PaystackPop.setup({
            key: 'pk_test_13679ac81d15c27422f43890078ec78da774f2d1',
            email,
            amount: price * 100, // Paystack expects the amount in Kobo
            currency: "NGN",
            ref: data.data.reference, // Use reference returned from the backend
            callback: function(response) {
              alert('Payment successful! Transaction reference: ' + response.reference);
              window.location.href = '/verify/' + response.reference;  // Verification URL
            },
            onClose: function() {
              alert('Transaction was not completed.');
            }
          });

          handler.openIframe();  // Open Paystack payment modal
        } else {
          alert('Payment initialization failed!');
        }
      });
    });
  </script>
</body>
</html>
